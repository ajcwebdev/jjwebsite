---
import DefaultLayout from '../../layouts/DefaultLayout.astro';
import { Breadcrumbs, BreadcrumbsItem } from 'accessible-astro-components';
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  // Get all posts from the 'blog' collection
  const blogPosts = await getCollection('blog');

  // Generate paths based on each post's slug
  return blogPosts.map((post) => ({
    params: { post: post.slug },
    props: { post },
  }));
}

const { post } = Astro.props;

// Helper function to format dates
function formatDate(dateStr) {
  const date = new Date(dateStr);
  if (isNaN(date)) return 'Date not available';
  return date.toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'long',
    day: 'numeric',
  });
}
---

<DefaultLayout
  title={post.data.title}
  description={post.data.description}
  url={`/blog/${post.slug}`}
>
  <div class="container">
    <div class="mt-12">
      <Breadcrumbs>
        <BreadcrumbsItem href="/" label="Home" />
        <BreadcrumbsItem href="/blog" label="Blog" />
        <BreadcrumbsItem currentPage={true} label={post.data.title} />
      </Breadcrumbs>
    </div>
  </div>

  <section class="my-12">
    <div class="container">
      <h1>{post.data.title}</h1>
      <p class="text-sm text-gray-600">
        By {post.data.author} on {formatDate(post.data.pubDate)}
      </p>
      <img src={post.data.imgUrl} alt={post.data.title} class="my-4" />
      <div class="content">
        {post.body} <!-- Renders the content of the markdown file -->
      </div>
    </div>
  </section>
</DefaultLayout>

<style lang="scss">
  .content {
    margin-top: 2rem;
  }
</style>